var app=angular.module("myRestaurantApp",["ngRoute","firebase","ngFacebook"]);app.run(["$rootScope",function(e){!function(){if(!document.getElementById("facebook-jssdk")){var e=document.getElementsByTagName("script")[0],n=document.createElement("script");n.id="facebook-jssdk",n.src="https://connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(n,e)}}()}]),app.config(["$facebookProvider",function(e){e.setAppId("413105435480517")}]),app.service("hexafy",function(){var e={myUrl:"img/avatar/blank.png",myUserName:"123",isSignedIn:!1,getUrl:function(){return e.myUrl},getUserName:function(){return e.myUserName},setUserName:function(n){e.myUserName=n},changeUrl:function(n){e.myUrl=n},getSignedIn:function(){return e.isSignedIn},signIn:function(){e.isSignedIn=!0},signOut:function(){e.isSignedIn=!1,console.log("You've signed out!"),e.myUrl="img/avatar/blank.png"}};return e}),app.controller("AvatarImgController",["$scope","$location","hexafy","$facebook",function(e,n,t,r){e.url="img/avatar/blank.png",e.usrName="",e.getUrl=t.getUrl,e.isLoggedIn=!1}]),app.controller("ClickRatingsController",["$scope",function(e){e.showCurrentRating=function(n){var t=e.showThisManyStars(n);return t},e.currentRating=0,e.lastClicked=1,e.clickedStars=function(n){e.lastClicked==n?(e.lastClicked=n,e.currentRating=e.currentRating+1,e.currentRating>5&&(e.currentRating=0)):(e.lastClicked=n,e.currentRating=n)},e.showStars=function(n){for(var t=1;t<=5;t++)return n<=e.currentRating?"★":"☆"},e.showThisManyStars=function(e){for(var n="",e=Math.round(e),t=0;t<e;t++)n+="★";for(var t=0;t<5-e;t++)n+="☆";return n}}]),app.controller("RestrController",["$scope","$routeParams","message","hexafy","$facebook",function(e,n,t,r,o){function a(n){o.api("/"+n+"/picture?type=large").then(function(n){e.usrProfilePicture=n.data.url,e.changeUrl(n.data.url),e.isLoggedIn=!0},function(e){console.log("Could not fetch profile picture.")})}e.restaurants=t,e.isSignedIn=r.getSignedIn,e.getAvatar=r.getUrl,e.login=function(){o.login().then(function(){r.signIn(),e.refresh()})},e.myFunction=function(){alert("Say bloo")},e.refresh=function(){o.api("/me").then(function(n){e.welcomeMsg="Welcome, "+n.name,console.log("Bird 123 "+n.name),console.log(r.getUserName()),r.setUserName(n.name),console.log(r.getUserName()),a(n.id),e.isLoggedIn=!0},function(n){e.welcomeMsg="Please log in ..."})},e.changeUrl=function(e){return r.changeUrl(e)};for(var i=0;i<e.restaurants.length;i++);e.bird="Nerd",e.sayHello=function(){return console.log("You clicked me"),"Bird"},e.page=n,e.myReview="Write a review...",e.addLikes=function(e){var n=this.restaurants[e];console.log(n.liked),0==n.liked&&(n.likes++,n.liked=!0)},e.currentUser=r.getUserName,e.currentRating=0,e.showReviewStars=function(e){for(var n="",e=Math.round(e),t=0;t<e;t++)n+="★";for(var t=0;t<5-e;t++)n+="☆";return n},e.updateAvgRatings=function(){for(var n=0;n<e.restaurants.length;n++){for(var t,r=0,o=0;o<e.restaurants[n].reviews.length;o++)r+=e.restaurants[n].reviews[o].rating;t=r/e.restaurants[n].reviews.length,e.restaurants[n].rating=parseFloat(t).toFixed(1)}},e.writeReview=function(n){var t=this.restaurants[n];0==t.reviewed&&(t.reviews.push({author:e.currentUser(),rating:e.currentRating,img:e.getAvatar(),dateposted:"2 minutes ago",review:e.myReview}),e.currentRating=0,t.reviewed=!0,e.updateAvgRatings())},e.getRestID=function(n){for(var t,r=0;r<e.restaurants.length;r++)n==e.restaurants[r].link&&(t=r);return t};var s=function(){e.updateAvgRatings()};s()}]),app.controller("LoginController",["$scope","$facebook","hexafy",function(e,n,t){function r(t){n.api("/"+t+"/picture?type=large").then(function(n){e.usrProfilePicture=n.data.url,e.changeUrl(n.data.url),e.isLoggedIn=!0},function(e){console.log("Could not fetch profile picture.")})}e.socialLogoUrl="img/facebook.png",e.getCurrentUser=t.getUserName,e.getUrl=t.getUrl,e.getLoggedIn=t.getSignedIn,e.login=function(){n.login().then(function(){t.signIn(),e.refresh()})},e.logout=function(){t.signOut()},e.refresh=function(){n.api("/me").then(function(n){e.welcomeMsg="Welcome, "+n.name,console.log("Bird 123 "+n.name),console.log(t.getUserName()),t.setUserName(n.name),console.log(t.getUserName()),r(n.id),e.isLoggedIn=!0},function(n){e.welcomeMsg="Please log in ..."})},e.changeUrl=function(e){return t.changeUrl(e)},e.refresh()}]),app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/main.html",controller:"RestrController",resolve:{message:["$http",function(e){return e.get("https://restaurantor-26d08.firebaseio.com/.json").then(function(e){return e.data})}]}}).when("/:pagename",{templateUrl:"templates/item.html",controller:"RestrController",resolve:{message:["$http",function(e){return e.get("https://restaurantor-26d08.firebaseio.com/.json").then(function(e){return e.data})}]}})}]),app.directive("w3TestDirective",function(){return{templateUrl:"/templates/directives/clickRatingsDirective.html",controller:"ClickRatingsController"}}),app.directive("navBar",function(){return{templateUrl:"templates/directives/navBarDirective.html"}});