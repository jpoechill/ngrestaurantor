var app=angular.module("myRestaurantApp",["ngRoute","firebase","ngFacebook"]);app.run(["$rootScope",function(e){!function(){if(!document.getElementById("facebook-jssdk")){var e=document.getElementsByTagName("script")[0],t=document.createElement("script");t.id="facebook-jssdk",t.src="https://connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(t,e)}}()}]),app.config(["$facebookProvider",function(e){e.setAppId("413105435480517")}]),app.service("hexafy",function(){var e={myUrl:"img/avatar/blank.png",myUserName:"123",isSignedIn:!1,getUrl:function(){return e.myUrl},getUserName:function(){return e.myUserName},setUserName:function(t){e.myUserName=t},changeUrl:function(t){e.myUrl=t},getSignedIn:function(){return e.isSignedIn},signIn:function(){e.isSignedIn=!0},signOut:function(){e.isSignedIn=!1,console.log("You've signed out!"),e.myUrl="img/avatar/blank.png"}};return e}),app.controller("AvatarImgController",["$scope","$location","hexafy","$facebook",function(e,t,n,r){e.url="img/avatar/blank.png",e.usrName="",e.getUrl=n.getUrl,e.isLoggedIn=!1}]),app.controller("ClickRatingsController",["$scope",function(e){e.showCurrentRating=function(t){var n=e.showThisManyStars(t);return n},e.currentRating=0,e.lastClicked=1,e.clickedStars=function(t){e.lastClicked==t?(e.lastClicked=t,e.currentRating=e.currentRating+1,e.currentRating>5&&(e.currentRating=0)):(e.lastClicked=t,e.currentRating=t)},e.showStars=function(t){for(var n=1;n<=5;n++)return t<=e.currentRating?"★":"☆"},e.showThisManyStars=function(e){for(var t="",e=Math.round(e),n=0;n<e;n++)t+="★";for(var n=0;n<5-e;n++)t+="☆";return t}}]),app.controller("RestrController",["$scope","$routeParams","message","hexafy","$facebook",function(e,t,n,r,o){e.restaurants=n,e.isSignedIn=r.getSignedIn,e.getAvatar=r.getUrl,e.login=function(){o.login().then(function(){r.signIn(),e.refresh()})},e.myFunction=function(){alert("Say bloo")},e.refresh=function(){o.api("/me").then(function(t){e.welcomeMsg="Welcome, "+t.name,r.setUserName("Poamrong Rith"),e.changeUrl("https://scontent.xx.fbcdn.net/v/t1.0-1/p200x200/14433090_10155342528024358_2772040946477423605_n.jpg?oh=5e7357bd902e31b762b30a1b5b721e4d&oe=588A8038"),e.isLoggedIn=!0},function(t){e.welcomeMsg="Please log in ..."})},e.changeUrl=function(e){return r.changeUrl(e)},e.page=t,e.myReview="Write a review...",e.addLikes=function(e){var t=this.restaurants[e];console.log(t.liked),0==t.liked&&(t.likes++,t.liked=!0)},e.currentUser=r.getUserName,e.currentRating=0,e.showReviewStars=function(e){for(var t="",e=Math.round(e),n=0;n<e;n++)t+="★";for(var n=0;n<5-e;n++)t+="☆";return t},e.updateAvgRatings=function(){for(var t=0;t<e.restaurants.length;t++){for(var n,r=0,o=0;o<e.restaurants[t].reviews.length;o++)r+=e.restaurants[t].reviews[o].rating;n=r/e.restaurants[t].reviews.length,e.restaurants[t].rating=parseFloat(n).toFixed(1)}},e.writeReview=function(t){var n=this.restaurants[t];0==n.reviewed&&(n.reviews.push({author:e.currentUser(),rating:e.currentRating,img:e.getAvatar(),dateposted:"2 minutes ago",review:e.myReview}),e.currentRating=0,n.reviewed=!0,e.updateAvgRatings())},e.getRestID=function(t){for(var n,r=0;r<e.restaurants.length;r++)t==e.restaurants[r].link&&(n=r);return n};var a=function(){e.updateAvgRatings()};a()}]),app.controller("LoginController",["$scope","$facebook","hexafy",function(e,t,n){function r(n){t.api("/"+n+"/picture?type=large").then(function(t){e.usrProfilePicture=t.data.url,e.changeUrl(t.data.url),e.isLoggedIn=!0},function(e){console.log("Could not fetch profile picture.")})}e.socialLogoUrl="img/facebook.png",e.getCurrentUser=n.getUserName,e.getUrl=n.getUrl,e.getLoggedIn=n.getSignedIn,e.login=function(){t.login().then(function(){n.signIn(),e.refresh()})},e.logout=function(){n.signOut()},e.refresh=function(){t.api("/me").then(function(t){e.welcomeMsg="Welcome, "+t.name,console.log("Bird 123 "+t.name),console.log(n.getUserName()),n.setUserName(t.name),console.log(n.getUserName()),r(t.id),e.isLoggedIn=!0},function(t){e.welcomeMsg="Please log in ..."})},e.changeUrl=function(e){return n.changeUrl(e)},e.refresh()}]),app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/main.html",controller:"RestrController",resolve:{message:["$http",function(e){return e.get("https://restaurantor-26d08.firebaseio.com/.json").then(function(e){return e.data})}]}}).when("/:pagename",{templateUrl:"templates/item.html",controller:"RestrController",resolve:{message:["$http",function(e){return e.get("https://restaurantor-26d08.firebaseio.com/.json").then(function(e){return e.data})}]}})}]),app.directive("w3TestDirective",function(){return{templateUrl:"/templates/directives/clickRatingsDirective.html",controller:"ClickRatingsController"}}),app.directive("navBar",function(){return{templateUrl:"templates/directives/navBarDirective.html"}});